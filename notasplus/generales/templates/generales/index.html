{% extends 'generales/base.html' %}

{% block title %}Inicio{% endblock %}

{% block content %}
  {# — Botón Crear Materia — #}
  <div class="d-flex justify-content-end mb-4">
    <a href="{% url 'materia_create' %}" class="btn btn-primary">
      ➕ Crear Materia
    </a>
  </div>

  {# — Tarjetas de Materias — #}
  <div class="row mb-5">
    {% for materia in materias %}
      <div class="col-md-4 mb-4">
        <div class="card h-100">
          <div class="card-body">
            <h5 class="card-title">{{ materia.nombre }}</h5>
            {% if materia.codigo %}
              <p class="card-text"><strong>Código:</strong> {{ materia.codigo }}</p>
            {% endif %}
            <a href="{% url 'materia_detail' materia.pk %}"
               class="btn btn-outline-primary mt-2">
              Ver Detalles
            </a>
          </div>
        </div>
      </div>
    {% empty %}
      <p class="text-muted">No hay materias registradas aún.</p>
    {% endfor %}
  </div>

  {# — Sección Alumnos — #}
  <div class="d-flex justify-content-start mb-2">
    <a href="{% url 'alumno_create' %}" class="btn btn-success">
      ➕ Agregar Alumno
    </a>
  </div>

  <table id="tabla-alumnos" class="table table-striped table-bordered">
    <thead>
      <tr>
        <th>Matrícula</th>
        <th>Nombre</th>
        <th>Apellido Paterno</th>
        <th>Apellido Materno</th>
        <th>Equipos</th>
        <th>Puntos Totales</th>
      </tr>
    </thead>
    <tbody>
      {% for alumno in alumnos %}
        <tr>
          <td>{{ alumno.matricula }}</td>
          <td>{{ alumno.nombre }}</td>
          <td>{{ alumno.apellido_paterno }}</td>
          <td>{{ alumno.apellido_materno }}</td>
          <td>
            {% for eq in alumno.equipos.all %}
              {{ eq.nombre }}{% if not forloop.last %}, {% endif %}
            {% empty %}
              —
            {% endfor %}
          </td>
          <td>{{ alumno.total_points|default:0 }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}

{% block extra_js %}
  {{ block.super }}
  <script>
    $(document).ready(function() {
      $('#tabla-alumnos').DataTable({
        responsive: true,
        language: {
          url: '//cdn.datatables.net/plug-ins/1.13.4/i18n/es-ES.json'
        }
      });
    });
  </script>
{% endblock %}
